<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å HTML5 API</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab-btn {
            background-color: #ecf0f1;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 1rem;
        }

        .tab-btn.active {
            background-color: #3498db;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background-color: #d5dbdb;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 1.6rem;
        }

        .drop-area {
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            background-color: #f8fafc;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .drop-area:hover, .drop-area.active {
            background-color: #e1f0fa;
            border-color: #2980b9;
        }

        .drop-area i {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }

        .drop-area p {
            margin-bottom: 10px;
            color: #34495e;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }

        .file-input-label:hover {
            background-color: #2980b9;
        }

        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .file-preview {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            padding: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #eaeaea;
        }

        .file-preview:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .file-icon {
            font-size: 36px;
            margin-bottom: 15px;
            color: #3498db;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            word-break: break-word;
        }

        .file-details {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .file-details p {
            margin-bottom: 5px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .preview-text {
            max-height: 150px;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .device-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .device-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }

        .device-btn:hover {
            background-color: #27ae60;
        }

        .device-btn.stop {
            background-color: #e74c3c;
        }

        .device-btn.stop:hover {
            background-color: #c0392b;
        }

        .device-output {
            margin-top: 20px;
            min-height: 200px;
            border-radius: 10px;
            overflow: hidden;
            background-color: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #cameraFeed, #map {
            width: 100%;
            height: 100%;
            min-height: 300px;
        }

        .location-info {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
        }

        .status-message {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: 500;
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #bdc3c7;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .device-controls {
                flex-direction: column;
            }
            
            .preview-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å HTML5 API</h1>
            <p class="subtitle">FileReader, Drag & Drop –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="fileReader">FileReader API</button>
            <button class="tab-btn" data-tab="dragDrop">Drag & Drop API</button>
            <button class="tab-btn" data-tab="devices">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</button>
        </div>

        <!-- FileReader API Tab -->
        <div class="tab-content active" id="fileReaderTab">
            <div class="section">
                <h2 class="section-title"><i>üìÅ</i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å FileReader API</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.</p>
                
                <div class="file-input-container">
                    <label for="fileInput" class="file-input-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</label>
                    <input type="file" id="fileInput" class="file-input" multiple>
                </div>
                
                <div class="preview-container" id="fileReaderPreview">
                    <!-- –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <!-- Drag & Drop API Tab -->
        <div class="tab-content" id="dragDropTab">
            <div class="section">
                <h2 class="section-title"><i>‚¨ÜÔ∏è</i> –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å Drag & Drop API</h2>
                <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ –æ–±–ª–∞—Å—Ç—å –Ω–∏–∂–µ –¥–ª—è –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.</p>
                
                <div class="drop-area" id="dropArea">
                    <i>üìÅ</i>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</p>
                    <p>–∏–ª–∏</p>
                    <label for="dropFileInput" class="file-input-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</label>
                    <input type="file" id="dropFileInput" class="file-input" multiple>
                </div>
                
                <div class="preview-container" id="dragDropPreview">
                    <!-- –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <!-- Devices API Tab -->
        <div class="tab-content" id="devicesTab">
            <div class="section">
                <h2 class="section-title"><i>üìç</i> –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —Å Geolocation API</h2>
                <p>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–∞—à–µ —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.</p>
                
                <div class="device-controls">
                    <button class="device-btn" id="getLocationBtn">–ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                </div>
                
                <div class="device-output">
                    <div id="map"></div>
                    <div id="locationInfo" class="location-info" style="display: none;">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title"><i>üì∑</i> –í–µ–±-–∫–∞–º–µ—Ä–∞ —Å Media Devices API</h2>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à—É –≤–µ–±-–∫–∞–º–µ—Ä—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.</p>
                
                <div class="device-controls">
                    <button class="device-btn" id="startCameraBtn">–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
                    <button class="device-btn" id="captureBtn" style="display: none;">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
                    <button class="device-btn stop" id="stopCameraBtn" style="display: none;">–í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
                </div>
                
                <div class="device-output">
                    <video id="cameraFeed" autoplay playsinline style="display: none;"></video>
                    <canvas id="photoCanvas" style="display: none;"></canvas>
                    <div id="cameraPlaceholder">
                        <div class="empty-state">
                            <i>üì∑</i>
                            <p>–ö–∞–º–µ—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</p>
                        </div>
                    </div>
                </div>
                
                <div id="photoResult" style="display: none;">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
        
        <div id="statusMessage"></div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const fileInput = document.getElementById('fileInput');
        const dropFileInput = document.getElementById('dropFileInput');
        const dropArea = document.getElementById('dropArea');
        const fileReaderPreview = document.getElementById('fileReaderPreview');
        const dragDropPreview = document.getElementById('dragDropPreview');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const startCameraBtn = document.getElementById('startCameraBtn');
        const captureBtn = document.getElementById('captureBtn');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        const cameraFeed = document.getElementById('cameraFeed');
        const photoCanvas = document.getElementById('photoCanvas');
        const photoResult = document.getElementById('photoResult');
        const locationInfo = document.getElementById('locationInfo');
        const statusMessage = document.getElementById('statusMessage');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let stream = null;
        let currentTab = 'fileReader';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            setupTabs();
            setupFileReader();
            setupDragDrop();
            setupDeviceControls();
        });
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª–∞–¥–æ–∫
        function setupTabs() {
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }
        
        function switchTab(tabId) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            tabBtns.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
            document.querySelector(`.tab-btn[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}Tab`).classList.add('active');
            
            currentTab = tabId;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
            if (tabId !== 'devices' && stream) {
                stopCamera();
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ FileReader API
        function setupFileReader() {
            fileInput.addEventListener('change', function(e) {
                handleFiles(this.files, fileReaderPreview);
            });
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Drag & Drop API
        function setupDragDrop() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('active');
            }
            
            function unhighlight() {
                dropArea.classList.remove('active');
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±—Ä–æ—Å–∞ —Ñ–∞–π–ª–æ–≤
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files, dragDropPreview);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ input –≤ –æ–±–ª–∞—Å—Ç–∏ drop
            dropFileInput.addEventListener('change', function() {
                handleFiles(this.files, dragDropPreview);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
        function handleFiles(fileList, previewContainer) {
            if (fileList.length === 0) return;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–≤—å—é
            previewContainer.innerHTML = '';
            
            Array.from(fileList).forEach(file => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    createFilePreview(file, e.target.result, previewContainer);
                };
                
                reader.onerror = function() {
                    showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + file.name, 'error');
                };
                
                // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–≥–æ —Ç–∏–ø–∞
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else if (file.type.startsWith('text/') || 
                           file.type === 'application/json') {
                    reader.readAsText(file);
                } else {
                    // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    createFilePreview(file, null, previewContainer);
                }
            });
            
            showStatus(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${fileList.length} —Ñ–∞–π–ª–æ–≤`, 'success');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞
        function createFilePreview(file, fileData, container) {
            const filePreview = document.createElement('div');
            filePreview.className = 'file-preview';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
            let fileIcon = 'üìÑ';
            let previewContent = '';
            
            if (file.type.startsWith('image/')) {
                fileIcon = 'üñºÔ∏è';
                previewContent = `<img src="${fileData}" class="preview-image" alt="${file.name}">`;
            } else if (file.type.startsWith('text/') || file.type === 'application/json') {
                fileIcon = 'üìù';
                // –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–µ–≤—å—é
                const textPreview = fileData.length > 500 ? 
                    fileData.substring(0, 500) + '...' : fileData;
                previewContent = `<div class="preview-text">${escapeHtml(textPreview)}</div>`;
            } else if (file.type.includes('pdf')) {
                fileIcon = 'üìï';
            } else if (file.type.includes('zip') || file.type.includes('rar')) {
                fileIcon = 'üì¶';
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
            const fileSize = formatFileSize(file.size);
            
            filePreview.innerHTML = `
                <div class="file-icon">${fileIcon}</div>
                <div class="file-name">${file.name}</div>
                <div class="file-details">
                    <p>–¢–∏–ø: ${file.type || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p>–†–∞–∑–º–µ—Ä: ${fileSize}</p>
                    <p>–ò–∑–º–µ–Ω–µ–Ω: ${new Date(file.lastModified).toLocaleDateString()}</p>
                </div>
                ${previewContent}
            `;
            
            container.appendChild(filePreview);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
        function setupDeviceControls() {
            // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
            getLocationBtn.addEventListener('click', getLocation);
            
            // –í–µ–±-–∫–∞–º–µ—Ä–∞
            startCameraBtn.addEventListener('click', startCamera);
            captureBtn.addEventListener('click', capturePhoto);
            stopCameraBtn.addEventListener('click', stopCamera);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
        function getLocation() {
            if (!navigator.geolocation) {
                showStatus('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                return;
            }
            
            showStatus('–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...', 'success');
            
            navigator.geolocation.getCurrentPosition(
                // –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
                (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
                    locationInfo.innerHTML = `
                        <h3>–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
                        <p>–®–∏—Ä–æ—Ç–∞: ${latitude.toFixed(6)}</p>
                        <p>–î–æ–ª–≥–æ—Ç–∞: ${longitude.toFixed(6)}</p>
                        <p>–¢–æ—á–Ω–æ—Å—Ç—å: ¬±${accuracy.toFixed(2)} –º–µ—Ç—Ä–æ–≤</p>
                    `;
                    locationInfo.style.display = 'block';
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º OpenStreetMap)
                    const map = document.getElementById('map');
                    map.innerHTML = `<iframe width="100%" height="300" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${longitude-0.01}%2C${latitude-0.01}%2C${longitude+0.01}%2C${latitude+0.01}&amp;layer=mapnik&amp;marker=${latitude}%2C${longitude}">
                        </iframe>`;
                    
                    showStatus('–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ', 'success');
                },
                // –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
                (error) => {
                    let errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
                            break;
                    }
                    
                    showStatus(errorMessage, 'error');
                },
                // –û–ø—Ü–∏–∏
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }
        
        // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
        async function startCamera() {
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: false 
                });
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã
                cameraFeed.srcObject = stream;
                cameraFeed.style.display = 'block';
                document.getElementById('cameraPlaceholder').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å—ä–µ–º–∫–∏ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                startCameraBtn.style.display = 'none';
                captureBtn.style.display = 'inline-block';
                stopCameraBtn.style.display = 'inline-block';
                
                showStatus('–ö–∞–º–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∫–∞–º–µ—Ä–µ:', error);
                showStatus('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ: ' + error.message, 'error');
            }
        }
        
        // –°—ä–µ–º–∫–∞ —Ñ–æ—Ç–æ
        function capturePhoto() {
            if (!stream) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∏—Ç–µ –∫–∞–º–µ—Ä—É', 'error');
                return;
            }
            
            const context = photoCanvas.getContext('2d');
            const width = cameraFeed.videoWidth;
            const height = cameraFeed.videoHeight;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas —Ä–∞–≤–Ω—ã–º–∏ –≤–∏–¥–µ–æ
            photoCanvas.width = width;
            photoCanvas.height = height;
            
            // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä –≤–∏–¥–µ–æ –Ω–∞ canvas
            context.drawImage(cameraFeed, 0, 0, width, height);
            
            // –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ canvas
            const photoDataUrl = photoCanvas.toDataURL('image/png');
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            photoResult.innerHTML = `
                <h3>–í–∞—à–µ —Ñ–æ—Ç–æ:</h3>
                <img src="${photoDataUrl}" alt="–°–Ω–∏–º–æ–∫ —Å –∫–∞–º–µ—Ä—ã" style="max-width: 100%; border-radius: 8px;">
                <button class="device-btn" id="downloadPhotoBtn" style="margin-top: 10px;">–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ</button>
            `;
            photoResult.style.display = 'block';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            document.getElementById('downloadPhotoBtn').addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = `photo-${new Date().getTime()}.png`;
                link.href = photoDataUrl;
                link.click();
            });
            
            showStatus('–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ —Å–¥–µ–ª–∞–Ω–æ', 'success');
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            cameraFeed.style.display = 'none';
            document.getElementById('cameraPlaceholder').style.display = 'block';
            
            startCameraBtn.style.display = 'inline-block';
            captureBtn.style.display = 'none';
            stopCameraBtn.style.display = 'none';
            
            photoResult.style.display = 'none';
            
            showStatus('–ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞', 'success');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 –±–∞–π—Ç';
            
            const k = 1024;
            const sizes = ['–±–∞–π—Ç', '–ö–ë', '–ú–ë', '–ì–ë'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message';
            
            if (type === 'success') {
                statusMessage.classList.add('status-success');
            } else if (type === 'error') {
                statusMessage.classList.add('status-error');
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                statusMessage.textContent = '';
                statusMessage.className = '';
            }, 5000);
        }
    </script>
</body>
</html>